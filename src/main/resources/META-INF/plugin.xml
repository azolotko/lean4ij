<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.onriv.ijpluginlean</id>
    <name>ij-plugin-lean</name>
    <vendor>onriv</vendor>

    <depends>com.intellij.modules.platform</depends>
<!--    <depends>com.intellij.modules.ultimate</depends>-->
    <depends>org.jetbrains.plugins.textmate</depends>
    <depends>com.redhat.devtools.lsp4ij</depends>

    <resource-bundle>messages.MyBundle</resource-bundle>

    <extensions defaultExtensionNs="com.intellij">
        <defaultLiveTemplates file="/liveTemplates/Lean4.xml"/>
        <liveTemplateContext
                contextId="Lean4"
                implementation="com.github.onriv.ijpluginlean.language.Lean4Context"/>
<!--        // from https://github.com/JetBrains/godot-support/blob/master/rider/src/main/resources/META-INF/plugin.xml-->
<!--        https://github.com/mallowigi/permify-jetbrains/blob/de27f901228919ce7eab0c37d8045443283fc4eb/src/main/resources/META-INF/plugin.xml#L26-->
        <textmate.bundleProvider implementation="com.github.onriv.ijpluginlean.language.TextMateBundleProvider"/>

<!--        lsp4ij says:-->
<!--        Indeed, when you manually define a File type for some file name patterns, you loose the TextMate syntax coloration.-->
<!--        see: https://github.com/redhat-developer/lsp4ij/blob/main/docs/DeveloperGuide.md#declare-file-mappings-->
<!--        indeed, this cannot use-->
<!--        <fileType-->
<!--                name="Lean4 File"-->
<!--                implementationClass="com.github.onriv.ijpluginlean.language.Lean4FileType"-->
<!--                fieldName="INSTANCE"-->
<!--                language="Lean4"-->
<!--                extensions="lean"/>-->

        <toolWindow factoryClass="com.github.onriv.ijpluginlean.toolWindow.LeanInfoViewWindowFactory" id="LeanInfoViewWindow"/>

        <!-- LSP -->
<!--        <platform.lsp.serverSupportProvider implementation="com.github.onriv.ijpluginlean.lsp.LeanLspServerSupportProvider"/>-->


        <!-- documentation for infoview -->
        <!-- TODO This seems not working on now -->
        <lang.documentationProvider language="LeanInfoview"
            implementationClass="com.github.onriv.ijpluginlean.infoview.InfoViewDocumentationProvider"/>

        <postStartupActivity implementation="com.github.onriv.ijpluginlean.project.LeanProjectActivity"/>

    </extensions>
    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <server id="LeanLanguageServerId"
                name="Lean Language Server"
                factoryClass="com.github.onriv.ijpluginlean.lsp.LeanLanguageServerFactory">
            <description><![CDATA[
        Some description written in HTML to display it in the LSP consoles view and Language Servers settings. TODO
        ]]>
            </description>
        </server>

        <fileNamePatternMapping patterns="*.lean4;*.lean"
                                serverId="LeanLanguageServerId"
                                languageId="lean"/>
    </extensions>

    <actions>
        <!-- Add your actions here -->
        <action id="MyCustomAction" class="com.github.onriv.ijpluginlean.actions.MyCustomAction" text="Say Hello" description="A custom action to say hello">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <!-- Add your actions here -->
        <action id="OpenLeanInfoView" class="com.github.onriv.ijpluginlean.actions.OpenLeanInfoView" text="Lean open info view" description="Lean open info view">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <action id="RestartLeanLsp" class="com.github.onriv.ijpluginlean.actions.RestartLeanLsp" text="Restart Lean Lsp Server" description="Restart Lean Lsp Server">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <action id="RestartCurrentLeanFile" class="com.github.onriv.ijpluginlean.actions.RestartCurrentFile" text="Restart Current Lean File" description="Restart Current Lean File">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
    </actions>

    <applicationListeners>
        <listener class="com.github.onriv.ijpluginlean.listeners.MyApplicationActivationListener" topic="com.intellij.openapi.application.ApplicationActivationListener"/>
    </applicationListeners>

    <projectListeners>
        <listener class="com.github.onriv.ijpluginlean.project.listeners.LeanFileEditorManagerListener" topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
    </projectListeners>


</idea-plugin>
