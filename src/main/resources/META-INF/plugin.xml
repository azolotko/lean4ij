<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>lean4ij</id>
    <name>Lean4ij</name>
    <vendor>onriv</vendor>

    <depends>com.intellij.modules.platform</depends>
<!--    <depends>com.intellij.modules.ultimate</depends>-->
    <depends>org.jetbrains.plugins.textmate</depends>
    <depends>com.redhat.devtools.lsp4ij</depends>

    <resource-bundle>messages.MyBundle</resource-bundle>

    <extensions defaultExtensionNs="com.intellij">
        <defaultLiveTemplates file="/liveTemplates/Lean4.xml"/>
        <liveTemplateContext
                contextId="Lean4"
                implementation="lean4ij.language.Lean4Context"/>
<!--        // from https://github.com/JetBrains/godot-support/blob/master/rider/src/main/resources/META-INF/plugin.xml-->
<!--        https://github.com/mallowigi/permify-jetbrains/blob/de27f901228919ce7eab0c37d8045443283fc4eb/src/main/resources/META-INF/plugin.xml#L26-->
        <textmate.bundleProvider implementation="lean4ij.language.TextMateBundleProvider"/>

<!--        lsp4ij says:-->
<!--        Indeed, when you manually define a File type for some file name patterns, you loose the TextMate syntax coloration.-->
<!--        see: https://github.com/redhat-developer/lsp4ij/blob/main/docs/DeveloperGuide.md#declare-file-mappings-->
<!--        indeed, this cannot use-->
<!--        <fileType-->
<!--                name="Lean4 File"-->
<!--                implementationClass="lean4ijuage.Lean4FileType"-->
<!--                fieldName="INSTANCE"-->
<!--                language="Lean4"-->
<!--                extensions="lean"/>-->

        <toolWindow factoryClass="lean4ij.toolWindow.LeanInfoViewWindowFactory" id="LeanInfoViewWindow"/>

        <!-- LSP -->
<!--        <platform.lsp.serverSupportProvider implementation="lean4ijLeanLspServerSupportProvider"/>-->


        <!-- documentation for infoview -->
        <!-- TODO This seems not working on now -->
        <lang.documentationProvider language="LeanInfoview"
            implementationClass="lean4ij.infoview.InfoViewDocumentationProvider"/>

        <postStartupActivity implementation="lean4ij.project.LeanProjectActivity"/>

        <!-- ref: https://plugins.jetbrains.com/docs/intellij/notifications.html#balloons -->
        <notificationGroup id="Custom Notification Group"
                           displayType="BALLOON"
                           key="notification.group.name"/>
    </extensions>
    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <server id="LeanLanguageServerId"
                name="Lean Language Server"
                factoryClass="lean4ij.lsp.LeanLanguageServerFactory">
            <description><![CDATA[
        Some description written in HTML to display it in the LSP consoles view and Language Servers settings. TODO
        ]]>
            </description>
        </server>

        <fileNamePatternMapping patterns="*.lean4;*.lean"
                                serverId="LeanLanguageServerId"
                                languageId="lean"/>
    </extensions>

    <actions>
        <action id="OpenLeanInfoView" class="lean4ij.actions.OpenLeanInfoView" text="Lean open info view" description="Lean open info view">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <action id="RestartLeanLsp" class="lean4ij.actions.RestartLeanLsp" text="Restart Lean Lsp Server" description="Restart Lean Lsp Server">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <action id="RestartCurrentLeanFile" class="lean4ij.actions.RestartCurrentFile" text="Restart Current Lean File" description="Restart Current Lean File">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
        <action id="DumpCoroutine" class="lean4ij.actions.CoroutineDebug" text="Dump Coroutine" description="Dump Coroutine">
            <add-to-group group-id="MainMenu" anchor="last"/>
        </action>
    </actions>

    <applicationListeners>
        <listener class="lean4ij.listeners.MyApplicationActivationListener" topic="com.intellij.openapi.application.ApplicationActivationListener"/>
    </applicationListeners>

    <projectListeners>
        <listener class="lean4ij.project.listeners.LeanFileEditorManagerListener" topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
    </projectListeners>


</idea-plugin>
